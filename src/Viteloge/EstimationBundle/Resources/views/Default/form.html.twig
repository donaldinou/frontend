{% extends 'VitelogeCoreBundle:Form:fields.html.twig' %}

{% block _estimation_ville_javascript %}
  <script type="text/javascript">
   $field = $('#{{ id }}');

   var $configs = {{ configs|json_encode|raw }};

   // custom configs
   $configs = $.extend($configs, {
     width: "100%",
     minimumInputLength: 3,
     ajax: {
       url: "/", {#"{{ VITELOGE_BASE_URL }}",#}
       dataType: 'jsonp',
       data: function(term,page) {
         return {
           term: term,
           controller: 'ajax',
           action: 'autocomplete_insee'
         }
       },
       results: function(data,page) {
         var nb_elems = data.length
         var results = new Array( nb_elems );
         for( var i = 0; i < nb_elems; ++i ) {
           results[i] = {
             id: data[i].insee,
             text: data[i].nom
           };
         }
         return {results:results};
       }
     },
     initSelection: function(element,callback) {
       var id=$(element).val();
       if ( id !== "" ) {
         $.ajax(  "/", {#"{{ VITELOGE_BASE_URL }}",#}
         {
           dataType: "jsonp",
           data: {
             controller: "ajax",
             action: "ville",
             insee: id
           }
         } ).done( function(data){ callback( { "id": data.insee, "text": data.nom } ); } );
       }
     }
   });
   // end of custom configs

   $field.select2($configs);
  </script>
{% endblock %}
